<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>NIST CSF 2.0 ‚Äì Questionnaire</title>

    <!-- Tailwind -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
    />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", sans-serif;
      }
    </style>

    <!-- React & ReactDOM -->
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>

    <!-- PropTypes requis par Recharts 1.x -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>

    <!-- Recharts UMD -->
    <script src="https://unpkg.com/recharts@1.6.2/umd/Recharts.min.js"></script>

    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- htm (JSX-like sans build) -->
    <script src="https://unpkg.com/htm@3.1.1/dist/htm.umd.js"></script>
  </head>

  <body class="bg-neutral-50">
    <div id="root"></div>

    <script>
      const { useState, useEffect, useMemo, useCallback, useRef } = React;
      const html = window.htm.bind(React.createElement);

      const {
        BarChart,
        Bar,
        XAxis,
        YAxis,
        CartesianGrid,
        Tooltip,
        ResponsiveContainer,
        Radar: RadarShape,
        RadarChart: RChart,
        PolarGrid,
        PolarAngleAxis,
        PolarRadiusAxis,
        Legend,
        Cell,
      } = Recharts;

      // ------------------ Donn√©es de base ------------------

      const FUNCTIONS = [
        { id: "GOVERN", fr: "Gouverner", en: "Govern" },
        { id: "IDENTIFY", fr: "Identifier", en: "Identify" },
        { id: "PROTECT", fr: "Prot√©ger", en: "Protect" },
        { id: "DETECT", fr: "D√©tecter", en: "Detect" },
        { id: "RESPOND", fr: "R√©pondre", en: "Respond" },
        { id: "RECOVER", fr: "R√©tablir", en: "Recover" },
      ];

      const QUESTIONS = [
        {
          id: "GV.OC-01",
          fn: "GOVERN",
          category: "GV.OC",
          fr: "La mission, les objectifs et les parties prenantes de l‚Äôorganisation sont-ils connus et utilis√©s pour guider les d√©cisions de gestion du risque cyber ?",
          en: "Are the organization‚Äôs mission, objectives, and stakeholders understood and used to guide cybersecurity risk management decisions?",
          detailFr:
            "<strong>Description d√©taill√©e :</strong> Cette question v√©rifie que la direction cartographie la mission, les objectifs strat√©giques, les parties prenantes et les activit√©s critiques pour √©clairer les arbitrages de cybers√©curit√©. Informations compl√©mentaires : rechercher des documents de planification strat√©gique, une cartographie des parties prenantes ou un registre d‚Äôalignement cyber/business mis √† jour.<br /><br /><strong>Exemples d‚Äôimpl√©mentation :</strong> ateliers r√©guliers entre la cybers√©curit√© et les m√©tiers pour r√©viser la mission, fiche de synth√®se reliant objectifs d‚Äôaffaires et risques cyber, int√©gration d‚Äôindicateurs cyber aux tableaux de bord de gouvernance.<br /><br /><strong>Exemples de documentations n√©cessaires :</strong> plan strat√©gique d‚Äôentreprise, √©nonc√© de mission et de vision, cartographie des processus et actifs critiques, registre des parties prenantes, registre d‚Äôalignement cyber/business ou tableaux de bord de gouvernance int√©grant des indicateurs cyber.",
          detailEn:
            "<strong>Detailed description:</strong> This item confirms leadership maps the mission, strategic objectives, stakeholders, and critical activities so cybersecurity tradeoffs align with business priorities. Additional guidance: look for strategic plans, stakeholder maps, or an updated cybersecurity-to-business alignment register.<br /><br /><strong>Implementation examples:</strong> recurring workshops between security and business leaders, summary sheets tying business goals to cyber risks, and cybersecurity KPIs embedded in governance dashboards.<br /><br /><strong>Supporting documentation examples:</strong> corporate strategic plan, mission and vision statement, critical process and asset map, stakeholder register, cybersecurity-to-business alignment log, or governance dashboards featuring cyber indicators.",
        },
        {
          id: "GV.OC-02",
          fn: "GOVERN",
          category: "GV.OC",
          fr: "Les r√¥les dans l‚Äô√©cosyst√®me (fournisseurs, partenaires, parties prenantes externes) et les d√©pendances associ√©es sont-ils identifi√©s pour √©clairer les d√©cisions de cybers√©curit√© ?",
          en: "Are ecosystem roles (suppliers, partners, external stakeholders) and related dependencies identified to inform cybersecurity decisions?",
          detailFr:
            "<strong>Description d√©taill√©e :</strong> Le contr√¥le s‚Äôassure que l‚Äôorganisation conna√Æt les relations critiques de sa cha√Æne de valeur et les d√©pendances externes qui influencent la gestion du risque cyber. Informations compl√©mentaires : v√©rifier la pr√©sence d‚Äôune cartographie des fournisseurs critiques, d‚Äôaccords de niveaux de service incluant des exigences cyber ou d‚Äôanalyses d‚Äôimpact supply chain.<br /><br /><strong>Exemples d‚Äôimpl√©mentation :</strong> registre des tiers critiques avec √©valuations de maturit√©, clauses de cybers√©curit√© int√©gr√©es aux contrats, comit√© de gouvernance supply chain/cyber se r√©unissant p√©riodiquement.<br /><br /><strong>Exemples de documentations n√©cessaires :</strong> cartographie de la cha√Æne d‚Äôapprovisionnement, registre des fournisseurs et partenaires critiques, SLA ou contrats avec clauses cyber, analyses d‚Äôimpact supply chain, comptes rendus de comit√© de gouvernance √©cosyst√®me.",
          detailEn:
            "<strong>Detailed description:</strong> This control ensures the organization understands critical value-chain relationships and external dependencies that shape cybersecurity risk management. Additional guidance: check for critical supplier maps, service-level agreements with security clauses, or supply-chain impact analyses.<br /><br /><strong>Implementation examples:</strong> a critical third-party register with maturity reviews, cybersecurity provisions embedded in contracts, and a joint supply-chain/cybersecurity governance forum that meets regularly.<br /><br /><strong>Supporting documentation examples:</strong> supply-chain mapping, critical third-party inventory, SLAs or contracts including cybersecurity clauses, supply-chain impact assessments, and governance committee minutes covering ecosystem dependencies.",
        },
        {
          id: "GV.OC-03",
          fn: "GOVERN",
          category: "GV.OC",
          fr: "Les exigences juridiques, r√©glementaires et contractuelles en mati√®re de cybers√©curit√©, de protection des donn√©es et de confidentialit√© sont-elles connues et int√©gr√©es dans la gestion des risques ?",
          en: "Are legal, regulatory, and contractual requirements for cybersecurity, data protection, and privacy understood and integrated into risk management?",
          detailFr:
            "<strong>Description d√©taill√©e :</strong> Cette question confirme que l‚Äôorganisation recense et suit les obligations externes affectant la cybers√©curit√© pour orienter les contr√¥les et priorit√©s. Informations compl√©mentaires : consulter un registre de conformit√©, les rapports de veille r√©glementaire ou les matrices d‚Äôobligations contractuelles.<br /><br /><strong>Exemples d‚Äôimpl√©mentation :</strong> inventaire des textes applicables avec responsables nomm√©s, processus de veille juridique partag√© avec la s√©curit√©, clauses de conformit√© cyber int√©gr√©es dans les revues de risques.<br /><br /><strong>Exemples de documentations n√©cessaires :</strong> registre de conformit√© ou matrice d‚Äôobligations, rapports de veille r√©glementaire, politique de protection des donn√©es, clauses contractuelles types, preuves d‚Äôaudits ou de contr√¥les de conformit√©.",
          detailEn:
            "<strong>Detailed description:</strong> This question confirms the organization catalogs and tracks external obligations impacting cybersecurity to steer controls and priorities. Additional guidance: look for compliance registers, regulatory watch reports, or matrices of contractual obligations.<br /><br /><strong>Implementation examples:</strong> inventory of applicable laws with assigned owners, a joint legal-security regulatory monitoring process, and cybersecurity compliance clauses embedded in risk reviews.<br /><br /><strong>Supporting documentation examples:</strong> compliance register or obligation matrix, regulatory watch reports, data protection policy, standard contractual clauses, and audit or compliance review evidence.",
        },
        {
          id: "GV.OC-04",
          fn: "GOVERN",
          category: "GV.OC",
          fr: "Les services et capacit√©s critiques, ainsi que leurs d√©pendances, sont-ils identifi√©s et prioris√©s pour supporter la gestion du risque cyber ?",
          en: "Are critical services and capabilities, along with their dependencies, identified and prioritized to support cybersecurity risk management?",
          detailFr:
            "<strong>Description d√©taill√©e :</strong> Le contr√¥le v√©rifie que l‚Äôorganisation conna√Æt les services essentiels et leurs d√©pendances technologiques ou op√©rationnelles pour cibler les efforts de protection. Informations compl√©mentaires : analyser les analyses d‚Äôimpact sur l‚Äôactivit√© (BIA), les cartographies d‚Äôarchitectures critiques ou les registres de d√©pendances.<br /><br /><strong>Exemples d‚Äôimpl√©mentation :</strong> catalogue des services critiques avec niveaux de priorit√©, matrices reliant services, actifs et propri√©taires, ateliers de revue des d√©pendances avec les m√©tiers.<br /><br /><strong>Exemples de documentations n√©cessaires :</strong> analyses d‚Äôimpact sur l‚Äôactivit√© (BIA), cartographies d‚Äôarchitecture critiques, registres des d√©pendances techniques et m√©tiers, fiches de services critiques, matrices services-actifs-propri√©taires.",
          detailEn:
            "<strong>Detailed description:</strong> This control checks that the organization understands essential services and their technological or operational dependencies to target protection efforts. Additional guidance: review business impact analyses, critical architecture maps, or dependency registers.<br /><br /><strong>Implementation examples:</strong> catalogs of critical services with priority tiers, matrices linking services, assets, and owners, and business workshops to review dependencies.<br /><br /><strong>Supporting documentation examples:</strong> business impact analyses, critical architecture diagrams, dependency registers, critical service profiles, and matrices connecting services to assets and owners.",
        },
        {
          id: "GV.OC-05",
          fn: "GOVERN",
          category: "GV.OC",
          fr: "Des exigences de r√©silience sont-elles d√©finies pour soutenir la prestation des services critiques identifi√©s ?",
          en: "Are resilience requirements defined to support delivery of the identified critical services?",
          detailFr:
            "<strong>Description d√©taill√©e :</strong> Cette question s‚Äôassure que les niveaux de r√©silience attendus (RTO/RPO, tol√©rance aux pannes, sc√©narios de continuit√©) sont √©tablis pour chaque service critique. Informations compl√©mentaires : examiner les strat√©gies de continuit√©, les plans de reprise ou les objectifs de disponibilit√© approuv√©s.<br /><br /><strong>Exemples d‚Äôimpl√©mentation :</strong> fiches de service d√©taillant RTO/RPO, tests r√©guliers de continuit√© v√©rifiant les seuils, int√©gration des exigences de r√©silience dans la gestion des changements et des contrats fournisseurs.<br /><br /><strong>Exemples de documentations n√©cessaires :</strong> strat√©gie de continuit√© d‚Äôactivit√©, plans de reprise et de continuit√© valid√©s, fiches de services avec RTO/RPO, rapports de tests de continuit√©, clauses de r√©silience dans les contrats fournisseurs ou proc√©dures de gestion des changements.",
          detailEn:
            "<strong>Detailed description:</strong> This question ensures expected resilience levels (RTO/RPO, fault tolerance, continuity scenarios) are defined for each critical service. Additional guidance: review continuity strategies, recovery plans, or approved availability objectives.<br /><br /><strong>Implementation examples:</strong> service profiles documenting RTO/RPO, regular continuity tests validating thresholds, and resilience requirements embedded in change management and supplier contracts.<br /><br /><strong>Supporting documentation examples:</strong> business continuity strategies, approved recovery and continuity plans, service profiles with RTO/RPO targets, continuity test reports, and supplier contracts or change procedures embedding resilience requirements.",
        },
        {
          id: "GV-01",
          fn: "GOVERN",
          category: "GV.OC",
          fr: "La direction d√©finit-elle des objectifs clairs pour la cybers√©curit√© align√©s sur la strat√©gie d‚Äôaffaires ?",
          en: "Does management define clear cybersecurity objectives aligned with business strategy?",
          detailFr:
            "<strong>Description d√©taill√©e :</strong> Cette question v√©rifie que le comit√© de direction formalise des orientations cybers√©curit√© mesurables et suivies, align√©es sur les objectifs globaux de l‚Äôorganisation. Informations compl√©mentaires : examiner la feuille de route cybers√©curit√©, les proc√®s-verbaux de comit√©s strat√©giques ou les tableaux de bord de pilotage reliant objectifs d‚Äôaffaires et indicateurs cyber.<br /><br /><strong>Exemples d‚Äôimpl√©mentation :</strong> revue trimestrielle des objectifs cyber en comit√© de direction, int√©gration d‚ÄôOKR ou de KPI cyber dans la gouvernance strat√©gique, communication d‚Äôune feuille de route cybers√©curit√© align√©e sur la strat√©gie m√©tier.<br /><br /><strong>Exemples de documentations n√©cessaires :</strong> strat√©gie cybers√©curit√© approuv√©e, proc√®s-verbaux de comit√©s de direction, tableaux de bord de suivi des objectifs, plan d‚Äôinvestissement ou feuille de route cyber align√©e sur la strat√©gie d‚Äôentreprise.",
          detailEn:
            "<strong>Detailed description:</strong> This control confirms leadership has documented, measurable cybersecurity objectives that stay aligned with broader business goals and receive regular oversight. Additional guidance: review the cybersecurity roadmap, strategic committee minutes, or dashboards that connect business objectives to cyber indicators.<br /><br /><strong>Implementation examples:</strong> quarterly executive reviews of cybersecurity objectives, embedding cyber OKRs or KPIs into strategic governance, and communicating a cybersecurity roadmap aligned with business strategy.<br /><br /><strong>Supporting documentation examples:</strong> approved cybersecurity strategy, executive committee minutes, performance dashboards tracking objectives, and cyber investment plans or roadmaps linked to enterprise strategy.",
        },
        {
          id: "GV.RM-01",
          fn: "GOVERN",
          category: "GV.RM",
          fr: "Les objectifs de gestion du risque cybers√©curit√© sont-ils d√©finis, mesurables et valid√©s par les parties prenantes organisationnelles ?",
          en: "Are cybersecurity risk management objectives defined, measurable, and endorsed by organizational stakeholders?",
          detailFr:
            "<strong>Description d√©taill√©e :</strong> Cette question v√©rifie que l‚Äôorganisation formalise des objectifs de gestion du risque cyber align√©s sur la mission et approuv√©s par les dirigeants cl√©s (comit√© ex√©cutif, m√©tiers, fonctions support). Informations compl√©mentaires : confirmer la pr√©sence d‚Äôune charte ou strat√©gie de gestion du risque pr√©cisant les attentes, indicateurs et d√©lais.<br /><br /><strong>Exemples d‚Äôimpl√©mentation :</strong> approbation annuelle d‚Äôobjectifs cyber par le comit√© de direction, int√©gration d‚Äôindicateurs de risque cl√©s (KRI) dans les tableaux de bord strat√©giques, engagement √©crit des parties prenantes sur les priorit√©s de r√©duction de risque.<br /><br /><strong>Exemples de documentations n√©cessaires :</strong> strat√©gie ou charte de gestion du risque cyber, proc√®s-verbaux de comit√©s validant les objectifs, tableaux de bord consolidant les KRI et suivi des objectifs, plan directeur cybers√©curit√© align√© sur la strat√©gie d‚Äôentreprise.",
          detailEn:
            "<strong>Detailed description:</strong> Confirm the organization formalizes cybersecurity risk management objectives that align with its mission and receive endorsement from key leaders (executive committee, business units, enabling functions). Additional guidance: look for a risk management charter or strategy that specifies expectations, indicators, and timeframes.<br /><br /><strong>Implementation examples:</strong> annual executive approval of cyber risk objectives, embedding key risk indicators (KRIs) into strategic dashboards, and documented stakeholder commitments to prioritized risk reduction initiatives.<br /><br /><strong>Supporting documentation examples:</strong> cybersecurity risk management strategy or charter, committee minutes approving objectives, dashboards consolidating KRIs and progress, and a cybersecurity master plan aligned with enterprise strategy.",
        },
        {
          id: "GV.RM-02",
          fn: "GOVERN",
          category: "GV.RM",
          fr: "Les d√©clarations d‚Äôapp√©tence et de tol√©rance au risque cyber sont-elles formalis√©es, approuv√©es et communiqu√©es √† l‚Äôensemble des parties prenantes ?",
          en: "Are cybersecurity risk appetite and tolerance statements formalized, approved, and communicated to all relevant stakeholders?",
          detailFr:
            "<strong>Description d√©taill√©e :</strong> Le contr√¥le confirme que l‚Äôorganisation d√©finit des seuils chiffr√©s ou qualitatifs d√©crivant le niveau de risque acceptable et les conditions d‚Äôescalade. Informations compl√©mentaires : identifier les liens entre app√©tence au risque, d√©cisions d‚Äôinvestissement et limites op√©rationnelles.<br /><br /><strong>Exemples d‚Äôimpl√©mentation :</strong> d√©claration d‚Äôapp√©tence au risque approuv√©e par le conseil d‚Äôadministration, grilles de tol√©rance int√©gr√©es aux comit√©s d‚Äôinvestissement, communication des seuils aux √©quipes op√©rationnelles via des notes ou formations d√©di√©es.<br /><br /><strong>Exemples de documentations n√©cessaires :</strong> d√©claration d‚Äôapp√©tence et de tol√©rance au risque, proc√®s-verbaux du conseil ou du comit√© d‚Äôaudit, guides de d√©cision ou matrices d‚Äôescalade, supports de communication ou de formation diffusant les seuils de risque.",
          detailEn:
            "<strong>Detailed description:</strong> This item ensures the organization defines quantitative or qualitative thresholds describing acceptable cyber risk levels and escalation triggers. Additional guidance: verify connections between risk appetite, investment decisions, and operational limits.<br /><br /><strong>Implementation examples:</strong> board-approved risk appetite statement, tolerance grids embedded in investment committees, and communication of thresholds to operational teams through memos or dedicated training.<br /><br /><strong>Supporting documentation examples:</strong> risk appetite and tolerance statement, board or audit committee minutes, decision guides or escalation matrices, and communication or training materials that disseminate risk thresholds.",
        },
        {
          id: "GV.RM-03",
          fn: "GOVERN",
          category: "GV.RM",
          fr: "Les crit√®res d‚Äôidentification, d‚Äô√©valuation et de priorisation des risques cyber sont-ils d√©finis, coh√©rents et appliqu√©s ?",
          en: "Are criteria for identifying, evaluating, and prioritizing cyber risks defined, consistent, and applied?",
          detailFr:
            "<strong>Description d√©taill√©e :</strong> Cette question s‚Äôassure que la m√©thodologie d‚Äôanalyse de risques pr√©cise les cat√©gories, √©chelles d‚Äôimpact/probabilit√© et r√®gles de priorisation utilis√©es dans toute l‚Äôorganisation. Informations compl√©mentaires : v√©rifier la coh√©rence des outils (registres, matrices) et leur alignement avec la strat√©gie de gestion des risques.<br /><br /><strong>Exemples d‚Äôimpl√©mentation :</strong> taxonomie des risques partag√©e, matrice d‚Äô√©valuation normalis√©e dans l‚Äôoutil GRC, validations crois√©es entre m√©tiers et cybers√©curit√© avant de classer les risques, comit√© d‚Äôarbitrage pour harmoniser les priorit√©s.<br /><br /><strong>Exemples de documentations n√©cessaires :</strong> m√©thodologie ou guide d‚Äô√©valuation des risques, matrices d‚Äôimpact/probabilit√©, registres de risques illustrant l‚Äôapplication des crit√®res, preuves de revues d‚Äôharmonisation (comptes rendus, rapports de qualit√© des donn√©es).",
          detailEn:
            "<strong>Detailed description:</strong> Verify the risk analysis methodology defines categories, impact/likelihood scales, and prioritization rules that are applied consistently across the organization. Additional guidance: confirm supporting tools (registers, matrices) are aligned with the stated risk management strategy.<br /><br /><strong>Implementation examples:</strong> shared risk taxonomy, standardized evaluation matrix configured in the GRC tool, joint validation between business and cybersecurity teams before ranking risks, and an arbitration forum to harmonize priorities.<br /><br /><strong>Supporting documentation examples:</strong> risk assessment methodology or guide, impact/likelihood matrices, risk registers showing the applied criteria, and evidence of harmonization reviews (minutes, data quality reports).",
        },
        {
          id: "GV.RM-04",
          fn: "GOVERN",
          category: "GV.RM",
          fr: "La strat√©gie de gestion des risques cyber est-elle int√©gr√©e au dispositif global de gestion des risques de l‚Äôentreprise et guide-t-elle les d√©cisions de traitement ?",
          en: "Is the cybersecurity risk management strategy integrated with the organization‚Äôs enterprise risk management and used to guide risk treatment decisions?",
          detailFr:
            "<strong>Description d√©taill√©e :</strong> Le contr√¥le v√©rifie que les analyses cyber alimentent les processus globaux de gestion des risques (ERM) et que les d√©cisions de traitement refl√®tent les priorit√©s d‚Äôentreprise. Informations compl√©mentaires : observer la circulation des informations entre comit√©s cyber, ERM et m√©tiers, ainsi que l‚Äôalignement avec les strat√©gies sectorielles.<br /><br /><strong>Exemples d‚Äôimpl√©mentation :</strong> int√©gration des risques cyber au registre de risques d‚Äôentreprise, participation conjointe des responsables cyber aux comit√©s ERM, arbitrages budg√©taires bas√©s sur une vision consolid√©e des risques, synchronisation des plans de traitement avec les programmes m√©tiers.<br /><br /><strong>Exemples de documentations n√©cessaires :</strong> politique ERM incluant la cybers√©curit√©, registre de risques d‚Äôentreprise int√©grant les risques cyber, comptes rendus de comit√©s ERM/cyber, plans de traitement montrant la prise en compte des priorit√©s business.",
          detailEn:
            "<strong>Detailed description:</strong> Confirm cybersecurity risk analyses feed into enterprise risk management (ERM) processes and that treatment decisions reflect broader business priorities. Additional guidance: observe information flow between cyber, ERM, and business committees and alignment with sector or business-unit strategies.<br /><br /><strong>Implementation examples:</strong> integrating cyber risks into the enterprise risk register, joint participation of cybersecurity leaders in ERM committees, budget trade-offs based on a consolidated risk view, and synchronization of treatment plans with business programs.<br /><br /><strong>Supporting documentation examples:</strong> ERM policy referencing cybersecurity, enterprise risk register including cyber risks, ERM/cyber committee minutes, and treatment plans demonstrating alignment with business priorities.",
        },
        {
          id: "GV.RM-05",
          fn: "GOVERN",
          category: "GV.RM",
          fr: "La strat√©gie de gestion des risques cyber est-elle revue p√©riodiquement pour int√©grer les √©volutions de menaces, de r√©glementation et de contexte organisationnel ?",
          en: "Is the cybersecurity risk management strategy reviewed periodically to incorporate changes in threats, regulations, and organizational context?",
          detailFr:
            "<strong>Description d√©taill√©e :</strong> Cette question confirme l‚Äôexistence d‚Äôun cycle de revue d√©fini pour actualiser la strat√©gie, tenant compte des retours d‚Äôexp√©rience, des √©volutions technologiques et des exigences r√©glementaires. Informations compl√©mentaires : v√©rifier la fr√©quence des revues, la participation des parties prenantes et la tra√ßabilit√© des d√©cisions.<br /><br /><strong>Exemples d‚Äôimpl√©mentation :</strong> revues annuelles ou semestrielles en comit√© de risques, exercices de simulation int√©grant de nouveaux sc√©narios de menace, mises √† jour formalis√©es apr√®s incidents majeurs ou changements r√©glementaires.<br /><br /><strong>Exemples de documentations n√©cessaires :</strong> calendrier des revues strat√©giques, rapports d‚Äôactualisation ou de le√ßons apprises, comptes rendus de comit√©s, suivi des actions issues des revues, analyses de veille r√©glementaire et technologique.",
          detailEn:
            "<strong>Detailed description:</strong> Ensure a defined review cycle updates the strategy based on lessons learned, technology evolution, and regulatory requirements. Additional guidance: confirm the review cadence, stakeholder participation, and traceability of resulting decisions.<br /><br /><strong>Implementation examples:</strong> annual or semiannual risk committee reviews, simulation exercises introducing new threat scenarios, and formal updates triggered by major incidents or regulatory changes.<br /><br /><strong>Supporting documentation examples:</strong> strategic review schedule, update or lessons-learned reports, committee minutes, action trackers from reviews, and regulatory or technology watch analyses.",
        },
        {
          id: "GV.RM-06",
          fn: "GOVERN",
          category: "GV.RM",
          fr: "Les d√©cisions d‚Äôinvestissement, de ressources et de capacit√©s en cybers√©curit√© sont-elles align√©es sur la strat√©gie de gestion des risques et les priorit√©s valid√©es ?",
          en: "Are cybersecurity investment, resource, and capability decisions aligned with the risk management strategy and approved priorities?",
          detailFr:
            "<strong>Description d√©taill√©e :</strong> Le contr√¥le v√©rifie que la strat√©gie de risque sert de base aux arbitrages budg√©taires et aux plans de capacit√©s (personnes, processus, technologies). Informations compl√©mentaires : analyser comment les analyses de risques alimentent les business cases, feuilles de route et plans de transformation.<br /><br /><strong>Exemples d‚Äôimpl√©mentation :</strong> budg√©tisation bas√©e sur les risques avec tra√ßabilit√© vers les analyses, comit√©s d‚Äôinvestissement √©valuant l‚Äôimpact sur les objectifs de risque, plan de mont√©e en maturit√© priorisant les capacit√©s en fonction des sc√©narios critiques.<br /><br /><strong>Exemples de documentations n√©cessaires :</strong> dossiers d‚Äôinvestissement ou business cases r√©f√©rant aux analyses de risque, feuilles de route capacit√©s/maturit√©, proc√®s-verbaux de comit√©s d‚Äôinvestissement, tableaux de bord de suivi budg√©taire align√©s sur les priorit√©s de risque.",
          detailEn:
            "<strong>Detailed description:</strong> Confirm the risk strategy underpins budget trade-offs and capability plans covering people, processes, and technology. Additional guidance: analyze how risk assessments feed business cases, roadmaps, and transformation plans.<br /><br /><strong>Implementation examples:</strong> risk-based budgeting with traceability to assessments, investment committees evaluating impact on risk objectives, and capability maturity plans prioritizing critical scenarios.<br /><br /><strong>Supporting documentation examples:</strong> investment dossiers or business cases referencing risk analyses, capability or maturity roadmaps, investment committee minutes, and budget dashboards aligned with risk priorities.",
        },
        {
          id: "GV.RM-07",
          fn: "GOVERN",
          category: "GV.RM",
          fr: "Les opportunit√©s strat√©giques (risques positifs) sont-elles caract√©ris√©es et int√©gr√©es aux discussions sur le risque cyber de l‚Äôorganisation ?",
          en: "Are strategic opportunities (positive risks) characterized and included in the organization‚Äôs cybersecurity risk discussions?",
          detailFr:
            "<strong>Description d√©taill√©e :</strong> Cette question v√©rifie que l‚Äôorganisation consid√®re les opportunit√©s g√©n√©r√©es par la gestion du risque cyber (avantages concurrentiels, gains d‚Äôefficacit√©, innovation) et les incorpore aux d√©cisions strat√©giques. Informations compl√©mentaires : v√©rifier la pr√©sence d‚Äôun registre des opportunit√©s, l‚Äôanalyse co√ªts/b√©n√©fices et les √©changes avec l‚Äôinnovation ou les m√©tiers.<br /><br /><strong>Exemples d‚Äôimpl√©mentation :</strong> inclusion des opportunit√©s cyber dans les comit√©s d‚Äôinvestissement, identification de diff√©renciateurs commerciaux li√©s √† la confiance num√©rique, projets d‚Äôinnovation s√©curis√©e √©valu√©s conjointement par la cybers√©curit√© et les m√©tiers.<br /><br /><strong>Exemples de documentations n√©cessaires :</strong> registre de risques/opportunit√©s, comptes rendus de comit√©s abordant les opportunit√©s positives, analyses de cas d‚Äôusage montrant les b√©n√©fices s√©curitaires, pr√©sentations strat√©giques reliant initiatives cyber et avantages business.",
          detailEn:
            "<strong>Detailed description:</strong> Verify the organization considers opportunities created by cybersecurity risk management (competitive advantage, efficiency gains, innovation) and incorporates them into strategic decision-making. Additional guidance: look for an opportunity register, cost/benefit analyses, and collaboration with innovation or business teams.<br /><br /><strong>Implementation examples:</strong> including cyber-related opportunities in investment committees, identifying commercial differentiators tied to digital trust, and evaluating secure innovation projects jointly by cybersecurity and business teams.<br /><br /><strong>Supporting documentation examples:</strong> risk/opportunity register, meeting minutes covering positive opportunities, case analyses highlighting security-driven benefits, and strategic presentations linking cyber initiatives to business advantages.",
        },
        {
          id: "ID-01",
          fn: "IDENTIFY",
          category: "ID.AM",
          fr: "Les actifs critiques (applications, donn√©es, infrastructures) sont-ils inventori√©s et classifi√©s ?",
          en: "Are critical assets (applications, data, infrastructure) inventoried and classified?",
          detailFr:
            "<strong>Description d√©taill√©e :</strong> Le contr√¥le vise √† confirmer que tous les actifs critiques sont identifi√©s, cat√©goris√©s selon leur importance et mis √† jour pour soutenir les analyses de risques. Informations compl√©mentaires : v√©rifier l‚Äôexistence d‚Äôun r√©f√©rentiel d‚Äôactifs, d‚Äôune politique de classification et de processus de mise √† jour r√©guli√®re.<br /><br /><strong>Exemples d‚Äôimpl√©mentation :</strong> inventaire centralis√© des actifs critiques, classification par niveau de sensibilit√©, revue p√©riodique de la compl√©tude avec les propri√©taires d‚Äôactifs.<br /><br /><strong>Exemples de documentations n√©cessaires :</strong> CMDB ou inventaire des actifs, politique de classification de l‚Äôinformation, fiches de criticit√©, rapports d‚Äôaudit sur l‚Äôinventaire, preuves de revues de mise √† jour.",
          detailEn:
            "<strong>Detailed description:</strong> This control ensures critical assets are identified, categorized by importance, and maintained in an up-to-date repository to support risk assessments. Additional guidance: confirm the presence of an asset repository, a classification policy, and a regular update process.<br /><br /><strong>Implementation examples:</strong> centralized inventory of critical assets, sensitivity-based classification, and periodic completeness reviews with asset owners.<br /><br /><strong>Supporting documentation examples:</strong> CMDB or asset inventory, information classification policy, criticality profiles, audit reports on asset inventories, and evidence of update reviews.",
        },
        {
          id: "ID-02",
          fn: "IDENTIFY",
          category: "ID.RA",
          fr: "Des √©valuations de risques cyber sont-elles r√©alis√©es r√©guli√®rement ?",
          en: "Are cyber risk assessments performed regularly?",
          detailFr:
            "<strong>Description d√©taill√©e :</strong> Il s‚Äôagit de v√©rifier que des analyses de risques p√©riodiques √©valuent les menaces, vuln√©rabilit√©s et impacts, et qu‚Äôelles d√©bouchent sur des plans d‚Äôactions. Informations compl√©mentaires : rechercher un calendrier d‚Äô√©valuations, des rapports r√©cents et un suivi des plans de traitement associ√©s.<br /><br /><strong>Exemples d‚Äôimpl√©mentation :</strong> campagnes annuelles d‚Äô√©valuation des risques, ateliers interfonctionnels pour qualifier les sc√©narios, suivi des plans de traitement en comit√© de risques.<br /><br /><strong>Exemples de documentations n√©cessaires :</strong> rapports d‚Äô√©valuation des risques, registre des sc√©narios et des plans d‚Äôaction, planning des √©valuations, comptes rendus de comit√©s de risques, indicateurs de suivi des plans de traitement.",
          detailEn:
            "<strong>Detailed description:</strong> Confirms that periodic risk assessments evaluate threats, vulnerabilities, and impacts, leading to actionable mitigation or treatment plans. Additional guidance: look for an assessment schedule, recent reports, and tracking of associated treatment plans.<br /><br /><strong>Implementation examples:</strong> annual risk assessment campaigns, cross-functional workshops to qualify scenarios, and treatment plan tracking within risk committees.<br /><br /><strong>Supporting documentation examples:</strong> risk assessment reports, scenario and action plan register, assessment calendar, risk committee minutes, and treatment plan performance indicators.",
        },
        {
          id: "PR-01",
          fn: "PROTECT",
          category: "PR.AC",
          fr: "Les acc√®s sont-ils g√©r√©s selon le principe du moindre privil√®ge ?",
          en: "Are accesses managed according to the least privilege principle?",
          detailFr:
            "<strong>Description d√©taill√©e :</strong> V√©rifiez que les droits d‚Äôacc√®s sont accord√©s en fonction des r√¥les, revus r√©guli√®rement et r√©voqu√©s d√®s qu‚Äôils ne sont plus n√©cessaires. Informations compl√©mentaires : examiner les politiques IAM, les revues d‚Äôacc√®s p√©riodiques et les proc√©dures de provisioning/deprovisioning.<br /><br /><strong>Exemples d‚Äôimpl√©mentation :</strong> mod√®les de r√¥les avec moindre privil√®ge, campagnes de recertification d‚Äôacc√®s, automatisation des retraits d‚Äôacc√®s lors des d√©parts.<br /><br /><strong>Exemples de documentations n√©cessaires :</strong> politique de gestion des acc√®s, matrices de r√¥les et privil√®ges, rapports de revues d‚Äôacc√®s, proc√©dures IAM, journaux de recertification ou de d√©sactivation.",
          detailEn:
            "<strong>Detailed description:</strong> Ensure access rights are role-based, reviewed regularly, and revoked promptly when no longer required to enforce least privilege. Additional guidance: review IAM policies, periodic access reviews, and provisioning/deprovisioning procedures.<br /><br /><strong>Implementation examples:</strong> role models enforcing least privilege, access recertification campaigns, and automated deprovisioning during offboarding.<br /><br /><strong>Supporting documentation examples:</strong> access management policy, role and privilege matrices, access review reports, IAM procedures, and recertification or deprovisioning logs.",
        },
        {
          id: "PR-02",
          fn: "PROTECT",
          category: "PR.IP",
          fr: "Des proc√©dures formelles existent-elles pour la gestion des changements ?",
          en: "Are formal procedures in place for change management?",
          detailFr:
            "<strong>Description d√©taill√©e :</strong> La proc√©dure de changement doit documenter les validations, tests, retours arri√®re et responsabilit√©s afin de limiter les risques op√©rationnels. Informations compl√©mentaires : rechercher un processus formalis√©, des formulaires de demande et des preuves de revues par un CAB ou comit√© de changement.<br /><br /><strong>Exemples d‚Äôimpl√©mentation :</strong> proc√©dure ITIL d√©taillant les √©tapes de validation, comit√© de changement hebdomadaire, v√©rification syst√©matique des plans de retour arri√®re.<br /><br /><strong>Exemples de documentations n√©cessaires :</strong> politique ou proc√©dure de gestion des changements, formulaires ou tickets de demande de changement, comptes rendus de CAB, calendrier des changements, rapports de tests et de plans de retour arri√®re.",
          detailEn:
            "<strong>Detailed description:</strong> Change processes should document approvals, testing, rollback plans, and ownership to limit operational and security risks. Additional guidance: identify the formal process, request templates, and evidence of CAB or change board reviews.<br /><br /><strong>Implementation examples:</strong> ITIL-based procedure detailing approval steps, weekly change advisory board meetings, and systematic validation of rollback plans.<br /><br /><strong>Supporting documentation examples:</strong> change management policy or procedure, change request forms or tickets, CAB minutes, change calendar, and testing or rollback evidence.",
        },
        {
          id: "DE-01",
          fn: "DETECT",
          category: "DE.CM",
          fr: "Un SOC ou une capacit√© de surveillance des journaux est-il en place ?",
          en: "Is a SOC or log monitoring capability in place?",
          detailFr:
            "<strong>Description d√©taill√©e :</strong> Le contr√¥le valide l‚Äôexistence d‚Äôune surveillance continue (SOC interne/externe) capable de d√©tecter rapidement des comportements anormaux. Informations compl√©mentaires : v√©rifier la couverture des journaux, les capacit√©s d‚Äôinvestigation et les engagements de service associ√©s.<br /><br /><strong>Exemples d‚Äôimpl√©mentation :</strong> SOC interne 24/7 ou service MSSP, corr√©lation automatis√©e via SIEM, proc√©dures d‚Äôescalade d√©finies pour les alertes critiques.<br /><br /><strong>Exemples de documentations n√©cessaires :</strong> charte ou contrat SOC/MSSP, plan de surveillance des journaux, tableaux de bord SIEM, rapports de d√©tection et d‚Äôescalade, proc√©dures op√©rationnelles standard (SOP) du SOC.",
          detailEn:
            "<strong>Detailed description:</strong> This item confirms continuous monitoring is in place‚Äîinternal or outsourced SOC‚Äîto rapidly detect anomalous behaviors. Additional guidance: validate log coverage, investigation capabilities, and related service commitments.<br /><br /><strong>Implementation examples:</strong> 24/7 internal SOC or MSSP service, automated SIEM correlation, and defined escalation procedures for critical alerts.<br /><br /><strong>Supporting documentation examples:</strong> SOC/MSSP charter or contract, log monitoring plan, SIEM dashboards, detection and escalation reports, and SOC standard operating procedures.",
        },
        {
          id: "RS-01",
          fn: "RESPOND",
          category: "RS.MI",
          fr: "Des plans de r√©ponse aux incidents sont-ils d√©finis et test√©s ?",
          en: "Are incident response plans defined and tested?",
          detailFr:
            "<strong>Description d√©taill√©e :</strong> Les plans doivent couvrir les sc√©narios majeurs, pr√©ciser les r√¥les et inclure des exercices r√©guliers pour v√©rifier l‚Äôefficacit√© de la r√©ponse. Informations compl√©mentaires : examiner la cartographie des sc√©narios, les proc√©dures d‚Äôescalade et les retours d‚Äôexp√©rience des exercices.<br /><br /><strong>Exemples d‚Äôimpl√©mentation :</strong> plan de r√©ponse aux incidents d√©taill√© par type d‚Äôincident, exercices annuels de simulation ou de table-top, revue post-incident int√©grant les enseignements dans le plan.<br /><br /><strong>Exemples de documentations n√©cessaires :</strong> plan de r√©ponse aux incidents, runbooks op√©rationnels, rapports d‚Äôexercices et de tests, fiches d‚Äôescalade et de communication, rapports post-incident.",
          detailEn:
            "<strong>Detailed description:</strong> Plans should cover major scenarios, clarify responsibilities, and include rehearsals or tabletop exercises to prove response effectiveness. Additional guidance: review scenario mapping, escalation procedures, and lessons learned from exercises.<br /><br /><strong>Implementation examples:</strong> incident response plan tailored to incident types, annual simulations or tabletop exercises, and post-incident reviews feeding updates into the plan.<br /><br /><strong>Supporting documentation examples:</strong> incident response plan, operational runbooks, exercise and test reports, escalation and communication playbooks, and post-incident reviews.",
        },
        {
          id: "RC-01",
          fn: "RECOVER",
          category: "RC.RP",
          fr: "Des plans de reprise des activit√©s sont-ils document√©s et test√©s ?",
          en: "Are business recovery plans documented and tested?",
          detailFr:
            "<strong>Description d√©taill√©e :</strong> Ce contr√¥le garantit la pr√©sence de proc√©dures de reprise document√©es, test√©es et align√©es sur les objectifs de continuit√© de l‚Äôorganisation. Informations compl√©mentaires : analyser les plans de reprise, les rapports de tests PRA/PCA et les m√©canismes de mise √† jour.<br /><br /><strong>Exemples d‚Äôimpl√©mentation :</strong> plans de reprise par application ou service, exercices r√©guliers de bascule, revue des enseignements et mise √† jour des proc√©dures apr√®s chaque test.<br /><br /><strong>Exemples de documentations n√©cessaires :</strong> plans de reprise d‚Äôactivit√© (PRA/PCA), proc√©dures de restauration, rapports de tests de continuit√©, listes de contacts de crise, calendriers de tests et preuves de mises √† jour.",
          detailEn:
            "<strong>Detailed description:</strong> Ensures recovery procedures are documented, tested, and aligned with organizational continuity objectives and recovery timeframes. Additional guidance: review recovery plans, PRA/BCP test reports, and update mechanisms.<br /><br /><strong>Implementation examples:</strong> service-specific recovery plans, regular failover exercises, and post-test reviews updating recovery procedures.<br /><br /><strong>Supporting documentation examples:</strong> business continuity/disaster recovery plans, restoration procedures, continuity test reports, crisis contact lists, test calendars, and evidence of plan updates.",
        },
      ];

      const BASE_FUNCTION_CATEGORIES = {
        GOVERN: ["GV.OC", "GV.RM", "GV.RR", "GV.PO", "GV.OV", "GV.SC"],
        IDENTIFY: ["ID.AM", "ID.BE", "ID.IM", "ID.RA", "ID.RM", "ID.SC"],
        PROTECT: ["PR.AA", "PR.AT", "PR.DS", "PR.MA", "PR.PS", "PR.IR"],
        DETECT: ["DE.AE", "DE.CM", "DE.DP"],
        RESPOND: ["RS.RP", "RS.CO", "RS.AN", "RS.MI", "RS.IM", "RS.RR"],
        RECOVER: ["RC.RP", "RC.IM", "RC.CO"],
      };

      const FUNCTION_CATEGORIES = FUNCTIONS.reduce((acc, fn) => {
        const base = BASE_FUNCTION_CATEGORIES[fn.id] || [];
        const fromQuestions = QUESTIONS.filter((q) => q.fn === fn.id).map(
          (q) => q.category
        );
        const unique = Array.from(new Set([...base, ...fromQuestions]));
        acc[fn.id] = unique;
        return acc;
      }, {});

      const CATEGORY_TO_FUNCTION = Object.entries(FUNCTION_CATEGORIES).reduce(
        (map, [fnId, categories]) => {
          categories.forEach((category) => {
            map[category] = fnId;
          });
          return map;
        },
        {}
      );

      const ALL_CATEGORIES = FUNCTIONS.reduce((list, fn) => {
        (FUNCTION_CATEGORIES[fn.id] || []).forEach((category) => {
          if (!list.includes(category)) list.push(category);
        });
        return list;
      }, []);

      const DEFAULT_ANSWERS = QUESTIONS.reduce((acc, q) => {
        acc[q.id] = { target: 4 };
        return acc;
      }, {});

      const DEFAULT_META = {
        project: "",
        assessor: "",
        org: "",
        date: "",
      };

      function createDefaultAnswers() {
        const copy = {};
        QUESTIONS.forEach((q) => {
          copy[q.id] = { ...DEFAULT_ANSWERS[q.id] };
        });
        return copy;
      }

      function normalizeMeta(meta) {
        return { ...DEFAULT_META, ...(meta || {}) };
      }

      const FUNCTION_COLORS = {
        GOVERN: "#1E3A8A",
        IDENTIFY: "#2563EB",
        PROTECT: "#059669",
        DETECT: "#9333EA",
        RESPOND: "#DC2626",
        RECOVER: "#EA580C",
      };

      const I18N = {
        fr: {
          appTitle: "NIST CSF 2.0 ‚Äì Questionnaire d‚Äô√©valuation",
          meta: "M√©tadonn√©es",
          project: "Projet",
          assessor: "√âvaluateur",
          org: "Organisation",
          date: "Date",
          globalLang: "Langue",
          dashboard: "Dashboard",
          maturityScore: "Score de maturit√©",
          maturityCurrent: "Maturit√© actuelle",
          maturityTargetLabel: "Cible",
          maturityTarget: "Score cible moyen",
          maturityByFn: "Maturit√© par Function",
          radarTitle: "Actuel vs Cible (par Function)",
          noDataYet:
            "Aucune donn√©e encore ‚Äî commence √† noter des questions pour alimenter le dashboard.",
          questions: "Questions",
          score: "Score",
          target: "Cible",
          comments: "Commentaires",
          searchPh: "Filtre (ID, texte, fonction...)",
          allFunctions: "Toutes les fonctions",
          filterByFunction: "Fonctions",
          filterByCategory: "Cat√©gories",
          allCategories: "Toutes les cat√©gories",
          functionColumn: "Fonction",
          categoryColumn: "Cat√©gorie",
          tips1: "üíæ Sauvegarde automatique (localStorage du navigateur).",
          tips2:
            "üì§ Exportez vos donn√©es (CSV, PDF ou JSON) ou üì• importez une √©valuation au format JSON.",
          cmmiInfo:
            "Notation sugg√©r√©e : 0‚Äì5 (inexistant √† optimis√©) selon CMMI / NIST.",
          targetInfo: "Objectif moyen saisi (0‚Äì5).",
          exportCsv: "Exporter en CSV",
          exportPdf: "Exporter en PDF",
          exportJson: "Exporter en JSON",
          importJson: "Importer une √©valuation (JSON)",
          importJsonSuccess: "√âvaluation import√©e avec succ√®s.",
          importJsonError:
            "Impossible de lire le fichier JSON. V√©rifiez le format du fichier.",
          resetForm: "R√©initialiser",
          confirmReset:
            "Voulez-vous vraiment r√©initialiser le questionnaire ? Toutes les r√©ponses et m√©tadonn√©es seront effac√©es.",
          infoLabel: "Afficher les d√©tails du contr√¥le",
        },
        en: {
          appTitle: "NIST CSF 2.0 ‚Äì Assessment Questionnaire",
          meta: "Metadata",
          project: "Project",
          assessor: "Assessor",
          org: "Organization",
          date: "Date",
          globalLang: "Language",
          dashboard: "Dashboard",
          maturityScore: "Maturity score",
          maturityCurrent: "Current maturity",
          maturityTargetLabel: "Target maturity",
          maturityTarget: "Average target score",
          maturityByFn: "Maturity by Function",
          radarTitle: "Current vs Target (by Function)",
          noDataYet:
            "No data yet ‚Äî start rating questions to feed the dashboard.",
          questions: "Questions",
          score: "Score",
          target: "Target",
          comments: "Comments",
          searchPh: "Filter (ID, text, function...)",
          allFunctions: "All functions",
          filterByFunction: "Functions",
          filterByCategory: "Categories",
          allCategories: "All categories",
          functionColumn: "Function",
          categoryColumn: "Category",
          tips1: "üíæ Autosave enabled (browser localStorage).",
          tips2:
            "üì§ Export your data (CSV, PDF, or JSON) or üì• import an assessment from JSON.",
          cmmiInfo:
            "Suggested rating: 0‚Äì5 (non-existent to optimized) based on CMMI / NIST.",
          targetInfo: "Average target set (0‚Äì5).",
          exportCsv: "Export to CSV",
          exportPdf: "Export to PDF",
          exportJson: "Export to JSON",
          importJson: "Import assessment (JSON)",
          importJsonSuccess: "Assessment imported successfully.",
          importJsonError:
            "Unable to read the JSON file. Please verify its format.",
          resetForm: "Reset",
          confirmReset:
            "Do you really want to reset the questionnaire? All answers and metadata will be cleared.",
          infoLabel: "Show control details",
        },
      };

      // ------------------ Helpers ------------------

      function avg(values) {
        const nums = (values || []).filter(
          (v) => typeof v === "number" && !Number.isNaN(v)
        );
        if (!nums.length) return 0;
        return nums.reduce((a, b) => a + b, 0) / nums.length;
      }

      function TargetBarShape(props) {
        const { x, y, width, height, fill } = props;

        if (
          !Number.isFinite(x) ||
          !Number.isFinite(y) ||
          !Number.isFinite(width) ||
          !Number.isFinite(height) ||
          width <= 0 ||
          height <= 0
        ) {
          return null;
        }

        const strokeWidth = 2;
        const inset = strokeWidth / 2;
        const effectiveWidth = width - strokeWidth;
        const effectiveHeight = height - strokeWidth;

        if (effectiveWidth <= 0 || effectiveHeight <= 0) {
          return null;
        }

        const left = x + inset;
        const right = x + width - inset;
        const top = y + inset;
        const bottom = y + height - inset;
        const maxRadius = Math.min(
          6,
          effectiveWidth / 2,
          effectiveHeight
        );

        const path = [
          `M ${left} ${bottom}`,
          `L ${left} ${top + maxRadius}`,
          `Q ${left} ${top} ${left + maxRadius} ${top}`,
          `L ${right - maxRadius} ${top}`,
          `Q ${right} ${top} ${right} ${top + maxRadius}`,
          `L ${right} ${bottom}`,
          "Z",
        ].join(" ");

        return html`<path
          d=${path}
          fill="none"
          stroke=${fill}
          strokeWidth=${strokeWidth}
          strokeDasharray="4 4"
        />`;
      }

      // ------------------ Composants UI ------------------

      function Card({ title, children }) {
        return html`
          <section className="bg-white rounded-2xl shadow-sm border border-neutral-200 p-4 md:p-6 mb-4">
            ${title &&
            html`<h2
              className="text-lg font-semibold text-neutral-900 mb-3 flex items-center gap-2"
            >
              ${title}
            </h2>`}
            ${children}
          </section>
        `;
      }

      function TextInput({ label, value, onChange, type = "text" }) {
        return html`
          <label className="block text-sm mb-2">
            <span className="text-neutral-700">${label}</span>
            <input
              className="mt-1 w-full rounded-lg border border-neutral-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              type=${type}
              value=${value || ""}
              onChange=${(e) => onChange(e.target.value)}
            />
          </label>
        `;
      }

      function SelectScore({ value, onChange }) {
        const options = [null, 0, 1, 2, 3, 4, 5];
        return html`
          <select
            className="w-full rounded-md border border-neutral-300 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            value=${value ?? ""}
            onChange=${(e) =>
              onChange(
                e.target.value === "" ? null : Number(e.target.value)
              )}
          >
            <option value="">‚Äì</option>
            ${options.map((v) =>
              v === null
                ? null
                : html`<option key=${v} value=${v}>${v}</option>`
            )}
          </select>
        `;
      }

      // ------------------ App principale ------------------

      function NistCsfQuestionnaire() {
        const [lang, setLang] = useState("fr");
        const t = I18N[lang];

        const [meta, setMeta] = useState(() => normalizeMeta());

        const [answers, setAnswers] = useState(() => createDefaultAnswers());
        const [search, setSearch] = useState("");
        const [functionFilter, setFunctionFilter] = useState("ALL");
        const [selectedCategories, setSelectedCategories] = useState(
          () => [...ALL_CATEGORIES]
        );
        const [infoExpanded, setInfoExpanded] = useState({});
        const fileInputRef = useRef(null);

        // ---- Chargement / sauvegarde locale ----

        useEffect(() => {
          try {
            const saved = JSON.parse(
              localStorage.getItem("nist-csf-questionnaire-v1") || "{}"
            );
            setMeta(normalizeMeta(saved.meta));
            if (saved.answers) {
              const merged = createDefaultAnswers();
              Object.entries(saved.answers).forEach(([id, value]) => {
                merged[id] = {
                  ...merged[id],
                  ...value,
                };
              });
              setAnswers(merged);
            }
            if (saved.lang && I18N[saved.lang]) setLang(saved.lang);
          } catch (e) {
            console.warn("No previous data", e);
          }
        }, []);

        useEffect(() => {
          const payload = { meta, answers, lang };
          localStorage.setItem(
            "nist-csf-questionnaire-v1",
            JSON.stringify(payload)
          );
        }, [meta, answers, lang]);

        const filteredQuestions = useMemo(() => {
          const s = search.toLowerCase();
          return QUESTIONS.filter((q) => {
            const matchesFunction =
              functionFilter === "ALL" || q.fn === functionFilter;
            if (!matchesFunction) return false;

            const matchesCategory =
              !selectedCategories.length ||
              selectedCategories.includes(q.category);
            if (!matchesCategory) return false;

            if (!s) return true;

            const text = (q[lang] || "").toLowerCase();
            return (
              q.id.toLowerCase().includes(s) ||
              q.category.toLowerCase().includes(s) ||
              text.includes(s)
            );
          });
        }, [search, lang, functionFilter, selectedCategories]);

        const stats = useMemo(() => {
          const byFn = {};
          FUNCTIONS.forEach((fn) => {
            byFn[fn.id] = { scores: [], targets: [] };
          });

          QUESTIONS.forEach((q) => {
            const a = answers[q.id];
            if (!a) return;
            if (typeof a.score === "number")
              byFn[q.fn].scores.push(a.score);
            if (typeof a.target === "number")
              byFn[q.fn].targets.push(a.target);
          });

          const radarData = FUNCTIONS.map((fn) => ({
            function: fn[lang],
            current: avg(byFn[fn.id].scores),
            target: avg(byFn[fn.id].targets),
          }));

          const allScores = QUESTIONS.map((q) => answers[q.id]?.score);
          const allTargets = QUESTIONS.map((q) => answers[q.id]?.target);
          const global = avg(allScores);
          const targetGlobal = avg(allTargets);

          return { byFn, radarData, global, targetGlobal };
        }, [answers, lang]);

        const maturityByFunctionData = useMemo(
          () =>
            FUNCTIONS.map((fn) => {
              const entry = stats.byFn[fn.id] || { scores: [], targets: [] };
              const value = avg(entry.scores);
              const target = avg(entry.targets);
              const targetGap = Math.max(0, target - value);
              return {
                id: fn.id,
                name: fn[lang],
                value,
                target,
                targetGap,
              };
            }),
          [lang, stats]
        );

        const hasScores = QUESTIONS.some(
          (q) => typeof answers[q.id]?.score === "number"
        );
        const hasTargets = QUESTIONS.some(
          (q) => typeof answers[q.id]?.target === "number"
        );
        const hasData = hasScores || hasTargets;
        const showTargetBars = maturityByFunctionData.some(
          (item) => item.targetGap > 0
        );

        const handleReset = useCallback(() => {
          if (!window.confirm(t.confirmReset)) return;

          setMeta({ project: "", assessor: "", org: "", date: "" });
          setAnswers(createDefaultAnswers());
          setSearch("");
          setFunctionFilter("ALL");
          setSelectedCategories([...ALL_CATEGORIES]);
          setInfoExpanded({});
        }, [t]);

        const handleToggleInfo = useCallback((id) => {
          setInfoExpanded((prev) => ({ ...prev, [id]: !prev[id] }));
        }, []);

        useEffect(() => {
          if (functionFilter === "ALL") {
            setSelectedCategories([...ALL_CATEGORIES]);
            return;
          }
          setSelectedCategories([
            ...(FUNCTION_CATEGORIES[functionFilter] || []),
          ]);
        }, [functionFilter]);

        const categoryOptions = useMemo(() => {
          if (functionFilter === "ALL") return ALL_CATEGORIES;
          return FUNCTION_CATEGORIES[functionFilter] || [];
        }, [functionFilter]);

        const handleCategoryClick = useCallback(
          (categoryId) => {
            setSelectedCategories((prev) => {
              if (prev.length === 1 && prev[0] === categoryId) {
                if (functionFilter === "ALL") {
                  return [...ALL_CATEGORIES];
                }
                return [...(FUNCTION_CATEGORIES[functionFilter] || [])];
              }
              return [categoryId];
            });
          },
          [functionFilter]
        );

        const resetCategoriesToDefault = useCallback(() => {
          if (functionFilter === "ALL") {
            setSelectedCategories([...ALL_CATEGORIES]);
            return;
          }
          setSelectedCategories([...(FUNCTION_CATEGORIES[functionFilter] || [])]);
        }, [functionFilter]);

        const handleExportCSV = useCallback(() => {
          const header = [
            "ID",
            t.functionColumn,
            t.categoryColumn,
            t.questions,
            t.score,
            t.target,
            t.comments,
          ];

          const csvRows = QUESTIONS.map((q) => {
            const fn = FUNCTIONS.find((f) => f.id === q.fn);
            const a = answers[q.id] || {};
            const clean = (value) =>
              (value ?? "")
                .toString()
                .replace(/"/g, '""')
                .replace(/\r?\n|\r/g, " ");

            return [
              q.id,
              fn ? fn[lang] : q.fn,
              q.category,
              q[lang],
              a.score ?? "",
              a.target ?? "",
              clean(a.comments || ""),
            ].map((value) => `"${clean(value)}"`).join(";");
          });

          const csvContent = [header.map((value) => `"${value}"`).join(";"), ...csvRows].join("\n");
          const blob = new Blob([csvContent], {
            type: "text/csv;charset=utf-8;",
          });
          const url = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.href = url;
          link.download = `nist-csf-questionnaire_${lang}.csv`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          URL.revokeObjectURL(url);
        }, [answers, lang, t]);

        const handleExportJSON = useCallback(() => {
          const payload = {
            meta,
            answers,
            lang,
          };
          const blob = new Blob([JSON.stringify(payload, null, 2)], {
            type: "application/json",
          });
          const url = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.href = url;
          link.download = `nist-csf-questionnaire_${lang}.json`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          URL.revokeObjectURL(url);
        }, [answers, lang, meta]);

        const handleExportPDF = useCallback(() => {
          if (!window.jspdf || !window.jspdf.jsPDF) {
            console.warn("jsPDF unavailable");
            return;
          }

          const doc = new window.jspdf.jsPDF({
            orientation: "portrait",
            unit: "pt",
            format: "a4",
          });

          const pageWidth = doc.internal.pageSize.getWidth();
          const pageHeight = doc.internal.pageSize.getHeight();
          const margin = 40;
          let y = margin;

          doc.setFontSize(16);
          doc.text(t.appTitle, margin, y);
          y += 24;

          doc.setFontSize(10);
          const metaEntries = [
            [t.project, meta.project],
            [t.assessor, meta.assessor],
            [t.org, meta.org],
            [t.date, meta.date],
          ];

          metaEntries.forEach(([label, value]) => {
            doc.text(`${label}: ${value || "-"}`, margin, y);
            y += 14;
          });

          y += 10;

          const addPageIfNeeded = (spaceNeeded = 0) => {
            if (y + spaceNeeded <= pageHeight - margin) return;
            doc.addPage();
            y = margin;
          };

          doc.setFont("helvetica", "bold");
          doc.setFontSize(14);
          doc.text(t.dashboard, margin, y);
          y += 18;

          doc.setFont("helvetica", "normal");
          doc.setFontSize(11);

          if (hasData) {
            const globalScoreText = `${t.maturityScore}: ${
              hasScores ? stats.global.toFixed(2) : "-"
            }`;
            const targetScoreText = `${t.maturityTarget}: ${
              hasTargets ? stats.targetGlobal.toFixed(2) : "-"
            }`;

            [globalScoreText, targetScoreText].forEach((line) => {
              const wrapped = doc.splitTextToSize(
                line,
                pageWidth - margin * 2
              );
              addPageIfNeeded(wrapped.length * 14);
              doc.text(wrapped, margin, y);
              y += wrapped.length * 14;
            });

            y += 6;
            doc.setFont("helvetica", "bold");
            doc.text(t.maturityByFn, margin, y);
            y += 16;
            doc.setFont("helvetica", "normal");

            FUNCTIONS.forEach((fn) => {
              const fnScores = stats.byFn[fn.id]?.scores || [];
              const fnTargets = stats.byFn[fn.id]?.targets || [];
              const hasFnScores = fnScores.length > 0;
              const hasFnTargets = fnTargets.length > 0;
              const line = `${fn[lang]} ‚Äì ${t.score}: ${
                hasFnScores ? avg(fnScores).toFixed(2) : "-"
              } | ${t.target}: ${
                hasFnTargets ? avg(fnTargets).toFixed(2) : "-"
              }`;
              const wrapped = doc.splitTextToSize(
                line,
                pageWidth - margin * 2
              );
              addPageIfNeeded(wrapped.length * 14);
              doc.text(wrapped, margin, y);
              y += wrapped.length * 14;
            });
          } else {
            const noDataLines = doc.splitTextToSize(
              t.noDataYet,
              pageWidth - margin * 2
            );
            addPageIfNeeded(noDataLines.length * 14);
            doc.text(noDataLines, margin, y);
            y += noDataLines.length * 14;
          }

          y += 18;
          doc.setFont("helvetica", "bold");
          doc.setFontSize(14);
          doc.text(t.questions, margin, y);
          y += 18;

          QUESTIONS.forEach((q) => {
            const fn = FUNCTIONS.find((f) => f.id === q.fn);
            const a = answers[q.id] || {};

            addPageIfNeeded(80);

            doc.setFont("helvetica", "bold");
            doc.setFontSize(12);
            doc.text(`${q.id} ‚Äì ${fn ? fn[lang] : q.fn}`, margin, y);
            y += 16;

            doc.setFont("helvetica", "normal");
            const questionLines = doc.splitTextToSize(q[lang], pageWidth - margin * 2);
            doc.text(questionLines, margin, y);
            y += questionLines.length * 14;

            const details = [
              `${t.score}: ${typeof a.score === "number" ? a.score : "-"}`,
              `${t.target}: ${typeof a.target === "number" ? a.target : "-"}`,
              `${t.comments}: ${a.comments ? a.comments.replace(/\r?\n|\r/g, " ") : "-"}`,
            ];

            details.forEach((line) => {
              addPageIfNeeded(20);
              const wrapped = doc.splitTextToSize(line, pageWidth - margin * 2);
              doc.text(wrapped, margin, y);
              y += wrapped.length * 14;
            });

            y += 10;
          });

          doc.save(`nist-csf-questionnaire_${lang}.pdf`);
        }, [answers, hasData, hasScores, hasTargets, lang, meta, stats, t]);

        const handleImportJSONClick = useCallback(() => {
          if (fileInputRef.current) {
            fileInputRef.current.click();
          }
        }, []);

        const handleImportJSON = useCallback(
          (event) => {
            const input = event.target;
            const file = input.files && input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = () => {
              try {
                const text = reader.result || "";
                const parsed = JSON.parse(text);

                if (!parsed || typeof parsed !== "object") {
                  throw new Error("Invalid JSON structure");
                }

                const nextMeta = normalizeMeta(parsed.meta);

                if (!parsed.answers || typeof parsed.answers !== "object") {
                  throw new Error("Missing answers");
                }

                const merged = createDefaultAnswers();
                Object.entries(parsed.answers).forEach(([id, value]) => {
                  if (merged[id]) {
                    merged[id] = {
                      ...merged[id],
                      ...value,
                    };
                  }
                });

                const nextLang =
                  parsed.lang && I18N[parsed.lang] ? parsed.lang : null;

                setMeta(nextMeta);
                setAnswers(merged);
                if (nextLang) {
                  setLang(nextLang);
                }

                window.alert(t.importJsonSuccess);
              } catch (error) {
                console.error("JSON import failed", error);
                window.alert(t.importJsonError);
              } finally {
                input.value = "";
              }
            };
            reader.onerror = () => {
              console.error("File reading error", reader.error);
              window.alert(t.importJsonError);
              input.value = "";
            };
            reader.readAsText(file);
          },
          [setAnswers, setLang, setMeta, t]
        );

        return html`
          <div className="min-h-screen bg-neutral-50 py-6 px-3 md:px-6">
            <div className="max-w-6xl mx-auto">
              <header className="mb-6 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                <div>
                  <h1 className="text-2xl md:text-3xl font-bold text-neutral-900">
                    ${t.appTitle}
                  </h1>
                  <p className="text-sm text-neutral-600 mt-1">
                    ${t.cmmiInfo}
                  </p>
                </div>
                <div className="flex items-center gap-2 self-start md:self-auto">
                  <span className="text-sm text-neutral-600">
                    ${t.globalLang}
                  </span>
                  <button
                    className="px-3 py-1 rounded-full border text-sm bg-white border-neutral-300 hover:border-blue-500 hover:text-blue-600"
                    onClick=${() => setLang(lang === "fr" ? "en" : "fr")}
                  >
                    ${lang === "fr" ? "EN üá¨üáß" : "FR üá´üá∑"}
                  </button>
                </div>
              </header>

              <div
                className="mb-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between"
              >
                <div className="flex flex-wrap gap-2">
                  <button
                    className="inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-red-200 bg-white text-sm font-medium text-red-600 hover:border-red-400 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-offset-1"
                    onClick=${handleReset}
                    type="button"
                  >
                    üîÑ ${t.resetForm}
                  </button>
                  <button
                    className="inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-neutral-300 bg-white text-sm font-medium text-neutral-700 hover:border-blue-500 hover:text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1"
                    onClick=${handleExportCSV}
                    type="button"
                  >
                    üìÑ ${t.exportCsv}
                  </button>
                  <button
                    className="inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-neutral-300 bg-white text-sm font-medium text-neutral-700 hover:border-blue-500 hover:text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1"
                    onClick=${handleExportPDF}
                    type="button"
                  >
                    üßæ ${t.exportPdf}
                  </button>
                  <button
                    className="inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-neutral-300 bg-white text-sm font-medium text-neutral-700 hover:border-blue-500 hover:text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1"
                    onClick=${handleExportJSON}
                    type="button"
                  >
                    üóÇÔ∏è ${t.exportJson}
                  </button>
                  <button
                    className="inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-neutral-300 bg-white text-sm font-medium text-neutral-700 hover:border-blue-500 hover:text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1"
                    onClick=${handleImportJSONClick}
                    type="button"
                  >
                    üì• ${t.importJson}
                  </button>
                  <input
                    ref=${fileInputRef}
                    type="file"
                    accept="application/json,.json"
                    className="hidden"
                    onChange=${handleImportJSON}
                  />
                </div>
                <div className="text-xs text-neutral-500 space-y-1">
                  <p>${t.tips1}</p>
                  <p>${t.tips2}</p>
                </div>
              </div>

              <!-- M√©tadonn√©es -->
              <${Card} title=${t.meta}>
                <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                  <${TextInput}
                    label=${t.project}
                    value=${meta.project}
                    onChange=${(v) => setMeta({ ...meta, project: v })}
                  />
                  <${TextInput}
                    label=${t.assessor}
                    value=${meta.assessor}
                    onChange=${(v) => setMeta({ ...meta, assessor: v })}
                  />
                  <${TextInput}
                    label=${t.org}
                    value=${meta.org}
                    onChange=${(v) => setMeta({ ...meta, org: v })}
                  />
                  <${TextInput}
                    label=${t.date}
                    type="date"
                    value=${meta.date}
                    onChange=${(v) => setMeta({ ...meta, date: v })}
                  />
                </div>
              <//>

              <!-- Dashboard -->
              <${Card} title=${t.dashboard}>
                ${hasData
                  ? html`
                      <div
                        className="grid grid-cols-1 lg:grid-cols-3 gap-4 items-start"
                      >
                        <div className="space-y-3">
                          <div
                            className="rounded-xl bg-blue-50 border border-blue-100 p-4"
                          >
                            <div
                              className="text-xs uppercase font-semibold text-blue-600 tracking-wide"
                            >
                              ${t.maturityScore}
                            </div>
                            <div
                              className="mt-2 text-3xl font-bold text-blue-900"
                            >
                              ${stats.global.toFixed(2)}
                            </div>
                            <div className="mt-1 text-xs text-blue-900/70">
                              (0‚Äì5)
                            </div>
                            <div className="mt-4 pt-3 border-t border-blue-100">
                              <div
                                className="text-xs uppercase font-semibold text-blue-600 tracking-wide"
                              >
                                ${t.maturityTarget}
                              </div>
                              <div
                                className="mt-2 text-2xl font-semibold text-blue-900"
                              >
                                ${stats.targetGlobal.toFixed(2)}
                              </div>
                              <div className="mt-1 text-xs text-blue-900/70">
                                ${t.targetInfo}
                              </div>
                            </div>
                          </div>

                          <div className="text-xs text-neutral-500 space-y-1">
                            <p>${t.tips1}</p>
                            <p>${t.tips2}</p>
                          </div>
                        </div>

                        <div className="lg:col-span-2 h-64">
                          <${ResponsiveContainer} width="100%" height="100%">
                            <${BarChart}
                              data=${maturityByFunctionData}
                            >
                              <${CartesianGrid} strokeDasharray="3 3" />
                              <${XAxis} dataKey="name" />
                              <${YAxis} domain=${[0, 5]} />
                              <${Tooltip}
                                formatter=${(value, name, props) => {
                                  if (props?.dataKey === "targetGap") {
                                    const target = props?.payload?.target;
                                    if (typeof target === "number") {
                                      return [target.toFixed(2), name];
                                    }
                                  }
                                  if (typeof value === "number") {
                                    return [value.toFixed(2), name];
                                  }
                                  return [value, name];
                                }}
                              />
                              <${Bar}
                                dataKey="value"
                                name=${t.maturityCurrent}
                                radius=${[6, 6, 0, 0]}
                                stackId="maturity"
                              >
                                ${maturityByFunctionData.map(
                                  (item) =>
                                    html`<${Cell}
                                      key=${item.id}
                                      fill=${FUNCTION_COLORS[item.id]}
                                    />`
                                )}
                              <//>
                              ${
                                showTargetBars &&
                                html`<${Bar}
                                  dataKey="targetGap"
                                  name=${t.maturityTargetLabel}
                                  shape=${TargetBarShape}
                                  isAnimationActive=${false}
                                  legendType="none"
                                  fill="transparent"
                                  stackId="maturity"
                                >
                                  ${maturityByFunctionData.map(
                                    (item) =>
                                      html`<${Cell}
                                        key=${`${item.id}-target`}
                                        fill=${FUNCTION_COLORS[item.id]}
                                      />`
                                  )}
                                <//>`
                              }
                            <//>
                          <//>
                          <p className="mt-2 text-xs text-neutral-500">
                            ${t.maturityByFn}
                          </p>
                        </div>
                      </div>

                      <div className="mt-6 h-72">
                        <${ResponsiveContainer} width="100%" height="100%">
                          <${RChart} data=${stats.radarData}>
                            <${PolarGrid} />
                            <${PolarAngleAxis} dataKey="function" />
                            <${PolarRadiusAxis} domain=${[0, 5]} />
                            <${RadarShape}
                              name="Current"
                              dataKey="current"
                              fill="#2563EB"
                              fillOpacity=${0.4}
                              stroke="#2563EB"
                            />
                            <${RadarShape}
                              name="Target"
                              dataKey="target"
                              fill="#F97316"
                              fillOpacity=${0.2}
                              stroke="#F97316"
                              strokeDasharray="4 4"
                            />
                            <${Legend} />
                          <//>
                        <//>
                        <p className="mt-2 text-xs text-neutral-500">
                          ${t.radarTitle}
                        </p>
                      </div>
                    `
                  : html`
                      <p className="text-sm text-neutral-500">
                        ${t.noDataYet}
                      </p>
                    `}
              <//>

              <!-- Questions -->
              <${Card} title=${t.questions}>
                <div className="flex flex-col gap-4 mb-3">
                  <div>
                    <div className="text-xs font-semibold uppercase text-neutral-500 tracking-wide mb-2">
                      ${t.filterByFunction}
                    </div>
                    <div className="flex items-center gap-2 overflow-x-auto pb-1 -mx-1 px-1">
                      <button
                        className="shrink-0 inline-flex items-center px-3 py-1.5 rounded-full border text-xs font-medium transition focus:outline-none focus:ring-2 focus:ring-offset-0 focus:ring-blue-500"
                        style=${{
                          backgroundColor:
                            functionFilter === "ALL" ? "#1F2937" : "white",
                          color: functionFilter === "ALL" ? "white" : "#374151",
                          borderColor:
                            functionFilter === "ALL" ? "#1F2937" : "#D1D5DB",
                        }}
                        onClick=${() => setFunctionFilter("ALL")}
                      >
                        ${t.allFunctions}
                      </button>
                      ${FUNCTIONS.map((fn) => {
                        const isActive = functionFilter === fn.id;
                        const activeStyles = {
                          backgroundColor: FUNCTION_COLORS[fn.id],
                          color: "white",
                          borderColor: FUNCTION_COLORS[fn.id],
                        };
                        const inactiveStyles = {
                          backgroundColor: FUNCTION_COLORS[fn.id] + "14",
                          color: FUNCTION_COLORS[fn.id],
                          borderColor: FUNCTION_COLORS[fn.id] + "40",
                        };
                        return html`
                          <button
                            key=${fn.id}
                            className="shrink-0 inline-flex items-center px-3 py-1.5 rounded-full border text-xs font-semibold uppercase tracking-wide transition focus:outline-none focus:ring-2 focus:ring-offset-0 focus:ring-blue-500"
                            style=${isActive ? activeStyles : inactiveStyles}
                            title=${fn[lang]}
                            onClick=${() =>
                              setFunctionFilter((prev) =>
                                prev === fn.id ? "ALL" : fn.id
                              )}
                          >
                            ${(fn[lang] || fn.id).toUpperCase()}
                          </button>
                        `;
                      })}
                    </div>
                  </div>

                  <div>
                    <div className="text-xs font-semibold uppercase text-neutral-500 tracking-wide mb-2">
                      ${t.filterByCategory}
                    </div>
                    <div className="flex items-center gap-2 overflow-x-auto pb-1 -mx-1 px-1">
                      <button
                        className="shrink-0 inline-flex items-center px-3 py-1.5 rounded-full border text-xs font-medium transition focus:outline-none focus:ring-2 focus:ring-offset-0 focus:ring-blue-500"
                        style=${{
                          backgroundColor: "#1F2937",
                          color: "white",
                          borderColor: "#1F2937",
                        }}
                        onClick=${resetCategoriesToDefault}
                        type="button"
                      >
                        ${t.allCategories}
                      </button>
                      ${categoryOptions.map((categoryId) => {
                        const fnId = CATEGORY_TO_FUNCTION[categoryId];
                        const baseColor = FUNCTION_COLORS[fnId] || "#1F2937";
                        const isActive = selectedCategories.includes(categoryId);
                        const activeStyles = {
                          backgroundColor: baseColor,
                          color: "white",
                          borderColor: baseColor,
                        };
                        const inactiveStyles = {
                          backgroundColor: baseColor + "14",
                          color: baseColor,
                          borderColor: baseColor + "40",
                        };
                        return html`
                          <button
                            key=${categoryId}
                            className="shrink-0 inline-flex items-center px-3 py-1.5 rounded-full border text-xs font-semibold uppercase tracking-wide transition focus:outline-none focus:ring-2 focus:ring-offset-0 focus:ring-blue-500"
                            style=${isActive ? activeStyles : inactiveStyles}
                            onClick=${() => handleCategoryClick(categoryId)}
                            type="button"
                          >
                            ${categoryId}
                          </button>
                        `;
                      })}
                    </div>
                  </div>

                  <div className="flex flex-col md:flex-row md:items-center gap-3">
                    <input
                      className="w-full md:w-80 rounded-lg border border-neutral-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      placeholder=${t.searchPh}
                      value=${search}
                      onChange=${(e) => setSearch(e.target.value)}
                    />
                  </div>
                </div>

                <div className="overflow-x-auto">
                  <table className="min-w-full text-sm border-t border-neutral-200">
                    <thead className="text-xs uppercase bg-neutral-100 text-neutral-700">
                      <tr>
                        <th className="px-3 py-2 text-left">${t.functionColumn}</th>
                        <th className="px-3 py-2 text-left">${t.categoryColumn}</th>
                        <th className="px-3 py-2 text-left">ID</th>
                        <th className="px-3 py-2 text-left">${lang === "fr" ? "Question" : "Question"}</th>
                        <th className="px-3 py-2 text-center w-16">
                          <span className="sr-only">${t.infoLabel}</span>
                        </th>
                        <th className="px-3 py-2 text-left w-24">${t.score}</th>
                        <th className="px-3 py-2 text-left w-24">${t.target}</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${filteredQuestions.map((q) => {
                        const fn = FUNCTIONS.find((f) => f.id === q.fn);
                        const a = answers[q.id] || {};
                        const detailText = lang === "fr" ? q.detailFr : q.detailEn;
                        const expanded = infoExpanded[q.id];
                        return html`
                          <${React.Fragment} key=${q.id}>
                            <tr className="border-t border-neutral-200 align-top">
                              <td className="px-3 py-3 text-xs font-semibold">
                                <span
                                  className="px-2 py-1 rounded-full text-[11px]"
                                  style=${{
                                    backgroundColor: FUNCTION_COLORS[q.fn] + "20",
                                    color: FUNCTION_COLORS[q.fn],
                                  }}
                                >
                                  ${fn ? fn[lang] : q.fn}
                                </span>
                              </td>
                              <td className="px-3 py-3 text-xs text-neutral-600">
                                ${q.category}
                              </td>
                              <td className="px-3 py-3 font-mono text-xs text-neutral-600">
                                ${q.id}
                              </td>
                              <td className="px-3 py-3 text-sm text-neutral-800">
                                <div>${q[lang]}</div>
                                ${detailText && expanded
                                  ? html`<p
                                      className="mt-2 rounded-lg border border-blue-100 bg-blue-50 px-3 py-2 text-xs text-blue-900"
                                      dangerouslySetInnerHTML=${{ __html: detailText }}
                                    />`
                                  : null}
                              </td>
                              <td className="px-3 py-3 text-center align-middle">
                                ${detailText
                                  ? html`<button
                                      type="button"
                                      className="inline-flex h-7 w-7 items-center justify-center rounded-full border border-blue-200 bg-blue-50 text-xs font-semibold text-blue-700 hover:border-blue-300 hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-400"
                                      title=${t.infoLabel}
                                      aria-label=${t.infoLabel}
                                      aria-expanded=${expanded ? "true" : "false"}
                                      onClick=${() => handleToggleInfo(q.id)}
                                    >
                                      i
                                    </button>`
                                  : html`<span className="text-neutral-300">‚Äì</span>`}
                              </td>
                              <td className="px-3 py-3">
                                <${SelectScore}
                                  value=${a.score}
                                  onChange=${(v) =>
                                    setAnswers({
                                      ...answers,
                                      [q.id]: { ...a, score: v },
                                    })}
                                />
                              </td>
                              <td className="px-3 py-3">
                                <${SelectScore}
                                  value=${a.target}
                                  onChange=${(v) =>
                                    setAnswers({
                                      ...answers,
                                      [q.id]: { ...a, target: v },
                                    })}
                                />
                              </td>
                            </tr>
                            <tr className="border-b border-neutral-200">
                              <td className="px-3 pb-4 pt-0" colSpan="7">
                                <div className="flex flex-col gap-2">
                                  <div className="text-xs font-medium text-neutral-600">
                                    ${t.comments}
                                  </div>
                                  <textarea
                                    className="w-full rounded-md border border-neutral-300 px-2 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    rows="2"
                                    value=${a.comments || ""}
                                    onChange=${(e) =>
                                      setAnswers({
                                        ...answers,
                                        [q.id]: {
                                          ...a,
                                          comments: e.target.value,
                                        },
                                      })}
                                  ></textarea>
                                </div>
                              </td>
                            </tr>
                          <//>
                        `;
                      })}
                    </tbody>
                  </table>
                </div>
              <//>

              <p className="mt-4 text-xs text-neutral-400">
                ${t.tips1}
              </p>
            </div>
          </div>
        `;
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(html`<${NistCsfQuestionnaire} />`);
    </script>
  </body>
</html>
